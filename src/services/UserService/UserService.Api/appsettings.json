{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Microsoft.EntityFrameworkCore": "Warning",
      "UserService": "Debug"
    }
  },
  "AllowedHosts": "*",
  "ConnectionStrings": {
    "DefaultConnection": "Host=localhost;Database=skillswap_userservice;Username=skillswap;Password=DohoTyson@1990?!;Port=5432;Pooling=true;MinPoolSize=5;MaxPoolSize=50;ConnectionIdleLifetime=300;ConnectionPruningInterval=10;",
    "Redis": "localhost:6379,connectTimeout=60000,connectRetry=3,defaultDatabase=0"
  },
  "JwtSettings": {
    "Secret": "${JWT_SECRET}",
    "Issuer": "SkillSwap",
    "Audience": "SkillSwap",
    "ExpireMinutes": 60
  },
  "RabbitMQ": {
    "Host": "localhost",
    "Username": "guest",
    "Password": "guest",
    "Port": 5672
  },
  "Urls": "http://localhost:5001",
  "ServiceEndpoints": {
    "Gateway": "http://localhost:8080",
    "UserService": "http://localhost:5001",
    "SkillService": "http://localhost:5002",
    "MatchmakingService": "http://localhost:5003",
    "AppointmentService": "http://localhost:5004",
    "VideocallService": "http://localhost:5005",
    "NotificationService": "http://localhost:5006"
  },
  "ServiceCommunication": {
    "UseGateway": true,
    "DefaultTimeout": "00:00:30",
    "EnableResponseCaching": true,
    "EnableMetrics": true,
    "EnableRequestDeduplication": true,
    "RetryPolicy": {
      "MaxRetries": 3,
      "BackoffStrategy": "ExponentialBackoff",
      "InitialDelay": "00:00:01",
      "MaxDelay": "00:00:10",
      "RetryOnTimeout": true,
      "UseJitter": true,
      "JitterFactor": 0.2,
      "RetryableStatusCodes": [408, 429, 500, 502, 503, 504],
      "RetryableExceptions": ["TimeoutException", "HttpRequestException", "TaskCanceledException"]
    },
    "CircuitBreaker": {
      "ExceptionsAllowedBeforeBreaking": 5,
      "DurationOfBreak": "00:00:30",
      "Timeout": "00:00:10",
      "FailureThreshold": 0.5,
      "MinimumThroughput": 10
    },
    "Caching": {
      "DefaultTTL": "00:05:00",
      "MaxCacheSize": 1000,
      "EnableETagSupport": true,
      "RespectCacheControlHeaders": true,
      "CacheKeyPrefix": "svc:user:",
      "EnableCompression": true,
      "CompressionThreshold": 1024,
      "PerServicePolicies": {
        "skillservice": {
          "Enabled": true,
          "TTL": "00:15:00",
          "CacheOnlySuccess": true,
          "CacheableMethods": ["GET"],
          "ExcludePatterns": [".*\\/health.*", ".*\\/metrics.*"],
          "IncludePatterns": []
        },
        "matchmakingservice": {
          "Enabled": false,
          "TTL": "00:02:00",
          "CacheOnlySuccess": true,
          "CacheableMethods": ["GET"],
          "ExcludePatterns": [],
          "IncludePatterns": []
        }
      }
    },
    "M2M": {
      "Enabled": true,
      "TokenEndpoint": "http://localhost:5001/users/auth/service-token",
      "ClientId": "service-userservice",
      "ClientSecret": "${M2M_CLIENT_SECRET}",
      "Scopes": ["api.read", "api.write"],
      "TokenLifetime": "01:00:00",
      "RefreshBeforeExpiry": "00:05:00",
      "EnableTokenCaching": true,
      "TokenCacheKeyPrefix": "m2m:token:",
      "UseMutualTLS": false
    },
    "Bulkhead": {
      "MaxParallelRequests": 100,
      "MaxQueuedRequests": 50,
      "PerServiceLimits": {
        "skillservice": 50,
        "matchmakingservice": 30,
        "appointmentservice": 30
      }
    },
    "Telemetry": {
      "EnableDetailedMetrics": true,
      "TraceBodyContent": false,
      "SampleRate": 1.0
    }
  },
  "HttpCaching": {
    "Enabled": true,
    "DefaultPrivateMaxAge": 300,
    "DefaultPublicMaxAge": 3600,
    "ETagEnabled": true,
    "AddCacheStatusHeader": true,
    "Policies": [
      {
        "PathPattern": "/api/users/profile/*",
        "MaxAge": 300,
        "Private": true,
        "VaryByUser": true
      },
      {
        "PathPattern": "/api/users/*/avatar",
        "MaxAge": 3600,
        "Private": false
      },
      {
        "PathPattern": "/api/auth/*",
        "NoStore": true
      }
    ]
  }
}
